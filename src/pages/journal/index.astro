---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ArticleCard from "../../components/ArticleCard.astro";
import { getCollection } from "astro:content";

const articles = (await getCollection("articles"))
  .sort((a,b) => b.data.date.valueOf() - a.data.date.valueOf());

const categories = Array.from(new Set(articles.map(a => a.data.category))).sort();
---
<BaseLayout title="Journal" description="Articles ULM : essais, sécurité, réglementation, voyages, technique.">
  <section class="container" style="padding: 28px 0 10px;">
    <div class="row" style="justify-content:space-between;align-items:flex-end;flex-wrap:wrap;">
      <div>
        <h1 style="margin:0 0 8px;">Journal</h1>
        <p class="lead">Des articles pour voler plus fin, rêver plus loin, et éviter les “tiens, bizarre…” en approche.</p>
      </div>
      <div class="row" style="gap:8px;flex-wrap:wrap;">
        {categories.map((c) => <span class="pill">{c}</span>)}
      </div>
    </div>
  </section>

  <section class="container" style="padding: 10px 0 26px;">
    <div class="card">
      <div class="pad">
        <div class="list">
          {articles.map((a) => (
            <ArticleCard
              href={`/journal/${a.slug}/`}
              title={a.data.title}
              description={a.data.description}
              date={a.data.date}
              category={a.data.category}
              tags={a.data.tags}
            />
          ))}
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
